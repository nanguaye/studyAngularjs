var myApp=angular.module("app",["ui.router","ngResource","ngAnimate"]);myApp.config(function(e,t){t.when("","/platform"),e.state("platform",{url:"/platform",views:{"@":{templateUrl:"./yeapp/pages/platform/platform.html",controller:"platformCtrl",controllerAs:"vm"}},resolve:{shopLists:function(e){return e({url:" http://192.168.144.71:1030/api/platform",method:"GET",params:{type:"platform"}}).success(function(e,t,o,r){}).error(function(e,t,o,r){})}}}).state("platform.shop",{url:"/shop?shopId",views:{"@":{templateUrl:"./yeapp/pages/shop/shop.html",controller:"shopCtrl",controllerAs:"vm"}},resolve:{productLists:function(e,t){var o=t.shopId;return e.productListsRes.get({shopId:o}).$promise.then(function(e){return e})}}}).state("platform.shop.productDetail",{url:"/productDetail?productId",views:{"@":{templateUrl:"./yeapp/pages/productDetail/productDetail.html",controller:"detailCtrl",controllerAs:"vm"}},resolve:{productDetails:function(e,t){return t.productDetailsRes.get().$promise.then(function(e){return console.log("value",e),e})["catch"](function(){console.log("error")})}}}).state("platform.user",{url:"/user?shopId",views:{"@":{templateUrl:"./yeapp/pages/user/user.html",controller:"userCtrl",controllerAs:"vm"}},resolve:{userInf:function(e,t,o){return e.userRes.get().$promise.then(function(e){return console.log("res",e),"error"===e.state&&(console.log("请登录"),o.go("platform.login",{shopId:t.shopId})),e})}}}).state("platform.login",{url:"/login?shopId",views:{"@":{templateUrl:"./yeapp/pages/login/login.html",controller:"loginCtrl",controllerAs:"vm"}}})}),myApp.run(function(){}),myApp.directive("item",function(){return{restrict:"E",scope:{shopList:"="},templateUrl:"./yeapp/directive/itemTemplate.html"}}),myApp.directive("popup",function(){return{restrict:"E",templateUrl:"./yeapp/directive/popup.html",transclude:!0,link:function(e,t,o,r){e.$on("popup-show",function(){e.show=!0}),e.close=function(){e.$emit("popup-close"),e.show=!1}}}}),myApp.directive("swipeimg",function(){return{restrict:"AE",replace:!0,link:function(e,t){setTimeout(function(){new Swiper(".swiper-container",{paginationClickable:!0,autoplay:2e3,loop:!0})})}}}),myApp.directive("msg",function(){return{restrict:"E",templateUrl:"./yeapp/directive/alertService.html"}}),myApp.directive("price",function(){return{restrict:"E",template:"<span style='color: #db5252' ng-transclude=''></span>",transclude:!0}}),myApp.directive("bottomnav",function(e,t){return{restrict:"E",templateUrl:"./yeapp/directive/bottomnav.html",replace:!0,link:function(o,r,p,s){o.goShop=function(){t.go("platform.shop",{shopId:e.shopId})},o.goUser=function(){t.go("platform.user",{shopId:e.shopId})}}}}),myApp.service("alertService",function(e,t,o){this.error=function(r){console.log("alert方法执行");var p=angular.element("<msg></msg>"),s=e.$new(),c=t(p)(s);$("body").append(c),s.msg=r,s.msgshow=!0,o(function(){s.msgshow=!1},1e3)}}),myApp.factory("resourcePool",function(e,t){var o={shopListsRes:e("api/platform?type=platform"),productListsRes:e("api/shop.json"),productDetailsRes:e("api/productDetail.json"),userRes:e("api/user.json")};return o}),myApp.controller("loginCtrl",function(){}),myApp.controller("platformCtrl",["$scope","shopLists","$state","$http",function(e,t,o,r){var p=this;p.shopLists=t.data.shopLists,p.goShop=function(e){o.go("platform.shop",{shopId:e.shopId})}}]),myApp.controller("detailCtrl",["resourcePool","$stateParams","productDetails",function(e,t,o){var r=this;r.yeData="[{startWeekDay:'1',endWeekDay:'4'}]",console.log("123",r.yeData),console.log("+++++",o),r.productShop=o.shop,r.productItem=o.item,r.tabClick=function(e){1===e?r.tabIndex=0:2===e?r.tabIndex=1:3===e&&(r.tabIndex=2)}}]),myApp.controller("userCtrl",["userInf","$scope",function(e,t){console.log("+++",e)}]),myApp.controller("shopCtrl",["$scope","productLists","alertService","$state","$timeout",function(e,t,o,r,p){$(window).scrollTop(0);var s=this;s.productLists=t,console.log(s.productLists),s.openEwm=function(){s.ewmShow=!0,p(function(){s.qrcode=new QRCode("qrcode",{text:"your content",width:160,height:160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})})},s.closeEwm=function(){s.ewmShow=!1},s.goDetail=function(e){r.go("platform.shop.productDetail",{productId:e.code})},s.addCart=function(t){event.stopPropagation(),console.log("product+++",t),s.productCart=t,e.$broadcast("popup-show",t),s.specData=[]},e.$on("popup-close",function(){console.log("弹窗关闭 广播事件"),s.specData=[],s.clearAllSpec()}),s.clearAllSpec=function(){for(var e=0;e<s.productCart.specLists.length;e++)for(var t=0;t<s.productCart.specLists[e].specValues.length;t++)console.log(s.productCart.specLists[e].specValues[t].specVal),s.productCart.specLists[e].specValues[t].checked=!1},s.clearSpec=function(e){for(var t=0;t<s.productCart.specLists.length;t++)if(s.productCart.specLists[t].id===e)for(var o=0;o<s.productCart.specLists[t].specValues.length;o++)s.productCart.specLists[t].specValues[o].checked=!1},s.selectSku=function(e,t){t.checked=!0;var o={};o.id=e.id,o.specName=e.specName,o.valueId=t.id,o.valueName=t.specVal;for(var r=!0,p=0;p<s.specData.length;p++)if(s.specData[p].id===e.id){if(r=!1,s.specData[p].valueId!==t.id){s.specData.splice(p,1),s.clearSpec(e.id),t.checked=!0,s.specData.push(o),console.log("同一个spec不同value",s.specData);break}s.specData.splice(p,1),t.checked=!1,console.log("同一个spec和value",s.specData)}r&&(t.checked=!0,s.specData.push(o))},s.addCartComfirm=function(){s.specData.length===s.productCart.specLists.length?console.log("所有规格都选好了"):o.error("请选择规格")}}]);